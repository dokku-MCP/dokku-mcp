# Dokku MCP Server Configuration Example
# Copy this file to config.yaml and modify as needed

# Transport configuration (choose stdio or sse)
transport:
  type: "stdio"      # "stdio" or "sse"
  host: "localhost"  # Only used for sse/HTTP
  port: 8080         # Only used for sse/HTTP
  
  # CORS configuration (only applies to SSE transport)
  cors:
    enabled: false   # Enable custom CORS middleware (default: false, uses mcp-go's "*")
    allowed_origins: []  # Empty = allow all when enabled
    # Examples:
    # - "https://app.example.com"      # Exact origin
    # - "*.example.com"                # Wildcard subdomain
    # - "*"                            # Allow all (explicit)
    allowed_methods:
      - "GET"
      - "POST"
      - "OPTIONS"
    allowed_headers:
      - "Content-Type"
      - "Authorization"
    max_age: 300     # Preflight cache duration in seconds (5 minutes)

log_level: "info"           # debug, info, warn, error
log_format: "json"          # json, text
expose_server_logs: false   # expose get_server_logs tool (disabled by default for security)
timeout: "30s"

# Dokku configuration
dokku_path: "/usr/bin/dokku"

# SSH configuration for Dokku connection
ssh:
  host: "localhost"
  port: 3022
  user: "dokku"
  key_path: ""    # Optional - leave empty for automatic authentication fallback

# SSH Authentication Priority (automatic fallback):
# 1. ssh-agent (if available and has keys loaded)
# 2. ~/.ssh/id_rsa (if file exists and is readable)  
# 3. ssh.key_path (if configured and accessible)
# 4. ssh-agent as last resort

# Plugin Discovery Configuration
plugin_discovery:
  enabled: true               # Enable/disable plugin discovery
  sync_interval: "5m"         # How often to check for plugin changes
                             # Use "0" or false to disable periodic sync
                             # Examples: "30s", "5m", "1h"

# Caching configuration
cache_enabled: true
cache_ttl: "5m"

security:
  # List of command patterns that are forbidden (substring matching)
  # Commands containing these patterns will be blocked
  blacklist:
    - "destroy"          # Blocks: apps:destroy, postgres:destroy, redis:destroy, etc.
    - "unset"            # Blocks: config:unset
    - "remove"           # Blocks: domains:remove, ssh-keys:remove, etc.
    - "uninstall"        # Blocks: plugin:uninstall
    
    # You can also be more specific:
    # - "apps:destroy"   # Only blocks exact apps:destroy command
    # - "postgres:"      # Blocks all postgres commands
    # - ":destroy"       # Blocks any service destroy command

# Logs configuration
logs:
  runtime:
    default_lines: 100      # Default number of log lines to retrieve
    max_lines: 1000         # Maximum number of log lines allowed
    stream_buffer_size: 1000 # Buffer size for log streaming (SSE only)
  
  build:
    max_size_mb: 10         # Maximum build log size in memory
    retention_minutes: 5    # How long to keep completed deployment logs

# Example configurations for different scenarios:

# Example 1: SSE transport with CORS for SaaS/production
# transport:
#   type: "sse"
#   host: "0.0.0.0"
#   port: 8080
#   cors:
#     enabled: true
#     allowed_origins:
#       - "https://app.yourdomain.com"
#       - "https://dashboard.yourdomain.com"
#       - "*.yourdomain.com"
#     allowed_methods:
#       - "GET"
#       - "POST"
#       - "OPTIONS"
#     allowed_headers:
#       - "Content-Type"
#       - "Authorization"
#     max_age: 300

# Example 2: Local Dokku instance
# ssh:
#   host: "localhost"
#   port: 22
#   user: "dokku"
#   key_path: ""

# Example 3: Remote Dokku with custom SSH key
# ssh:
#   host: "dokku.mydomain.com"
#   port: 22
#   user: "dokku"
#   key_path: "/home/user/.ssh/dokku_rsa"

# Example 4: Remote Dokku with custom port
# ssh:
#   host: "dokku.mydomain.com"
#   port: 2222
#   user: "dokku"
#   key_path: ""

# Example 5: Development environment with longer timeouts
# ssh:
#   host: "dev-dokku.local"
#   port: 22
#   user: "dokku"
#   key_path: ""
# timeout: "60s" 